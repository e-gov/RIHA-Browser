<div class="fixed-header">
  Dokumentatsioon
  <button (click)="closeModal(addForm)" class="btn btn-sm btn-default close-modal-btn pull-right"><i class="fa fa-remove" aria-hidden="true"></i></button>
</div>
<section class="col card p-3 main-content scrollable-modal-content">
  <div class="my-1">
    <app-tooltip [text]='"Laadi üles infosüsteemi dokumentatsioon: arhitektuuri dokument, eelanalüüs, liideste kirjeldus ja muud sarnast"'></app-tooltip>
    <form #addForm="ngForm">
      <div class="form-group">
        <label class="btn btn-default input-file-label mb-0" for="dataFile"><i class="fa fa-plus fa-fw" aria-hidden="true"></i>&nbsp; Laadi fail</label>
        <input class="d-none" id="dataFile" name="dataFile" type="file" (change)="fileChange($event, addForm)">
      </div>
      <div *ngIf="docFile != null" class="form-group">
        {{ docFile.name }}
        <i *ngIf="uploading" class="fa fa-spinner fa-spin fa-fw"></i>
      </div>
      <div class="form-group">
        või lisa viide
      </div>
      <div class="form-group" [ngClass]="{'has-danger': url.invalid && (url.dirty || url.touched)}">
        <label for="url" class="text-muted separated-text">URL:</label>
        <input id="url" class="form-control col-12"
               #url="ngModel"
               [disabled]="uploading"
               [(ngModel)]="data.url"
               type="url"
               placeholder="http://www.example.com"
               (keyup.enter)="addTechDoc(addForm)"
               name="url" url required>

      </div>
      <div class="form-group" [ngClass]="{'has-danger': name.invalid && (name.dirty || name.touched)}">
        <label for="name" class="text-muted separated-text">Pealkiri:</label>
        <input id="name" class="form-control col-12"
               #name="ngModel"
               [disabled]="uploading"
               [(ngModel)]="data.name"
               placeholder="Lähtekood"
               (keyup.enter)="addTechDoc(addForm)"
               name="name" required>

      </div>
      <div class="form-group row">
        <div class="col-12">
          <button class="btn btn-default pull-right"
                  [disabled]="uploading"
                  (click)="addTechDoc(addForm)"><i class="fa fa-plus fa-fw" aria-hidden="true"></i>&nbsp;Lisa</button>
        </div>
      </div>
    </form>
    <form #editForm="ngForm">
      <div class="expandable-blocks">
        <div class="expandable-block" *ngFor="let doc of documents; let i = index">
          <div class="expandable-block-header" [ngClass]="{'highlighted': blocks[i]}">
            <i class="fa fa-external-link text-primary"></i>
            <a href="{{ generalHelperService.getFileUrl(doc.url) }}" target="_blank">{{ doc.name }}</a>
            <button (click)="deleteTechDoc(i)" class="btn btn-danger btn-sm pull-right"><i class="fa fa-fw fa-trash-o"></i></button>
            <button (click)="blocks[i] = !blocks[i]" class="btn btn-sm pull-right mr-1" [ngClass]="{'btn-primary': !blocks[i], 'btn-warning': blocks[i] }"><i class="fa fa-fw fa-pencil"></i></button>
          </div>
          <div *ngIf="blocks[i]" class="expandable-block-body">
            <div class="form-group" [ngClass]="{'has-danger': urlEdit.invalid}">
              <label for="{{'url' + i}}" class="text-muted separated-text">URL:</label>
              <input id="{{'url' + i}}" class="form-control col-12"
                     [(ngModel)]="documents[i].url"
                     #urlEdit="ngModel"
                     type="url"
                     placeholder="http://www.example.com"
                     name="{{'url' + i}}" url required>

            </div>
            <div class="form-group" [ngClass]="{'has-danger': nameEdit.invalid}">
              <label for="{{'name' + i}}" class="text-muted separated-text">Pealkiri:</label>
              <input id="{{'name' + i}}" class="form-control col-12"
                     [(ngModel)]="documents[i].name"
                     #nameEdit="ngModel"
                     placeholder="Lähtekood"
                     name="{{'name' + i}}" required>

            </div>
          </div>
        </div>
      </div>
      <div class="actions-bar mt-2">
        <div class="buttons pull-right">
          <button (click)="saveSystem(editForm)" class="btn btn-success pull-right">Salvesta</button>
        </div>
      </div>
    </form>
  </div>
</section>
